<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>freeline</title>
    <style>
        canvas {border:5px solid magenta;}
    </style>
</head>
<body>
    <div>
        색상 :  
        <select id = "selcolor">
            <option value="rgba(255,255,0,0.6)">노랑</option>    
            <option value="rgba(255,0,0,0.3)">빨강</option>    
            <option value="rgba(0,255,0.5)">초록</option>    
            <option value="rgba(0,0,255,0.5)">파랑</option>     
        </select>

        <input type="button" id="clear" value="모두지움"/>
    </div>

    <canvas id="canvas" width="600" height="400">
        이 브라우저는 캔버스를 지원하지 않습니다 .
    </canvas>

    <script>
        var canvas;
        var ctx;
        var arRectangle = new Array();
        var sx, sy;     // 드래그 시작점
        var ex, ey;     // 드래그 끝점
        var color;      // 현재 색상
        var drawing = false;    // 그리고 있는 중인가
        var moving = -1;        // 이동중인 도형 첨자

        // 사각형 생성자
        function Rectangle(sx,sy,ex,ey,color){
            this.sx = sx;
            this.sy = sy;
            this.ex = ex;
            this.ey = ey;
            this.color = color;
        }

        // x,y 위치의 사각형 찾음, 없으면 -1
        function getRectangle(x,y){
            for(var i = 0; i < arRectangle.lenght; i++){
                var rect = arRectangle[i];
                if(x > rect.sx && x < rect.ex && y > rect.sy && rect.ey){
                    return i;
                }
            }
            return -1;
        }

        window.onload = function(){
            canvas = document.getElementById("canvas");
            if(canvas == null || canvas.getContext == null) return;
            ctx = canvas.getContext("2d");

            canvas.onmousedown = function(e){
                e.preventDefault();

                // 시작 좌표 구함
                sx = canvasX(e.clientX);
                sy = canvasY(e.clientY);

                // 백업 뜨고 그리기 시작
                backup = ctx.getImageData(0,0,canvas.width, canvas.height);
                drawing = true;
            }

            canvas.onmousemove = function(e){
                e.preventDefault();
                ex = canvasX(e.clientX);
                ey = canvasY(e.clientY);
                
                // 백업 복구하고 현재선 그림
                if(drawing){
                    ctx.putImageData(backup, 0,0);
                    ctx.beginPath();
                    ctx.moveTo(sx,sy);
                    ctx.lineTo(ex,ey);
                    ctx.stroke();
                }
            }

            canvas.onmouseup = function(e){
                drawing = false;
            }
        }

        var selcolor = document.getElementById("selcolor");
		selcolor.onchange = function(e) {
			ctx.strokeStyle = selcolor.value;
		}
		
		var selwidth = document.getElementById("selwidth");
		selwidth.onchange = function(e) {
			ctx.lineWidth = selwidth.value;
		}
		
		var btnclear = document.getElementById("clear");
		btnclear.onclick = function(e) {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}
		
		function canvasX(clientX) {
			var bound = canvas.getBoundingClientRect();
			var bw = 5;
			return (clientX - bound.left - bw) * (canvas.width / (bound.width - bw * 2));
		}
		
		function canvasY(clientY) {
			var bound = canvas.getBoundingClientRect();
			var bw = 5;
			return (clientY - bound.top - bw) * (canvas.height / (bound.height - bw * 2));
		}
        

    </script>
</body>